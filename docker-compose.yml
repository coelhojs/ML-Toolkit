version: "3"
services:
    server:
        build: ./API/
        ports:
            - 5001:5001
        restart: always
        depends_on: 
            - redis
        networks:
            - dockernet
    monitor:
        build: ./Task-Manager/
        ports:
            - 5555:5555
        entrypoint: flower
        command:  -A tasks --port=5555 --broker=redis://redis:6379/0
        depends_on:
            - redis
        networks:
            - dockernet
    redis:
        image: redis
        networks:
            - dockernet
    tf-serving:
        image: tensorflow/serving
        command: --model_config_file=/models/models.config
        depends_on:
            - redis
        networks:
            - dockernet
        ports:
            - 8501:8501
        restart: always
        volumes:
            -  //c/development/ML-Toolkit/Tensorflow-Serving/models:/models/
            # -  /home/cristiano/development/ML-Toolkit/Tensorflow-Serving/models:/models/
    worker:
        build:
            context: ./Task-Manager/
            dockerfile: Dockerfile
        depends_on:
            - redis
        networks:
            - dockernet
networks:
    dockernet:
        external: true